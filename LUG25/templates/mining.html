{% extends "base_app.html" %}

{% block title %}Mining ADG - Adelchi Group{% endblock %}

{% block extra_css %}
<style>
    /* COPIA TUTTO IL CSS DAL VECCHIO mining.html */
</style>
{% endblock %}

{% block content %}
<h1 class="page-title">‚õèÔ∏è Adelchi Mining Pool</h1>
<p class="page-subtitle">Unisciti alla rete blockchain Adelchi</p>

<!-- Stats Grid -->
<div class="stats-grid">
    <!-- ... resto contenuto ... -->
</div>

{% endblock %}

{% block extra_js %}
<script>
    /* COPIA TUTTO IL JAVASCRIPT */
</script>
{% endblock %}


<body>
    <div class="container">
        <div class="header">
            <h1>‚õèÔ∏è Adelchi Mining Pool</h1>
            <p>Unisciti alla rete blockchain Adelchi e inizia a minare token ADG</p>
        </div>

        <!-- Statistiche Globali -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-value" id="totalHashrate">2.4 TH/s</div>
                <div class="stat-label">Hashrate Totale</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-value" id="activeMiners">47</div>
                <div class="stat-label">Miners Attivi</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-value" id="blocksFound">1,337</div>
                <div class="stat-label">Blocchi Minati</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="totalRewards">89,245</div>
                <div class="stat-label">ADG Distribuiti</div>
            </div>
        </div>

        <!-- Contenuto Principale -->
        <div class="main-content">
            <!-- Registrazione Mining -->
            <div class="panel">
                <h2>üöÄ Registra il tuo Miner</h2>
                <form class="mining-form" id="minerRegistration">
                    <div class="form-group">
                        <label for="minerName">Nome Miner</label>
                        <input type="text" id="minerName" class="form-input" placeholder="Es: RTX3060-Gaming-Rig" required>
                    </div>
                    <div class="form-group">
                        <label for="gpuModel">Modello GPU</label>
                        <select id="gpuModel" class="form-input" required>
                            <option value="">Seleziona GPU</option>
                            <option value="rtx4090">RTX 4090</option>
                            <option value="rtx4080">RTX 4080</option>
                            <option value="rtx4070">RTX 4070</option>
                            <option value="rtx3090">RTX 3090</option>
                            <option value="rtx3080">RTX 3080</option>
                            <option value="rtx3070">RTX 3070</option>
                            <option value="rtx3060">RTX 3060</option>
                            <option value="rx7900xt">RX 7900 XT</option>
                            <option value="rx6800xt">RX 6800 XT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="walletAddress">Wallet ADG Address</label>
                        <input type="text" id="walletAddress" class="form-input" placeholder="ADG1A2B3C4D5E6F7G8H9I0J..." required>
                    </div>
                    <button type="submit" class="btn">üéØ Registra Miner</button>
                </form>
            </div>

            <!-- Lista Miners Attivi -->
            <div class="panel">
                <h2>üë• Miners Attivi</h2>
                <div class="miners-list" id="minersList">
                    <div class="miner-item">
                        <div class="miner-header">
                            <span class="miner-name">üñ•Ô∏è Adelchi-Prime-RTX3060</span>
                            <span class="miner-status status-online">Online</span>
                        </div>
                        <div class="miner-stats">
                            <div class="miner-stat">
                                <span class="miner-stat-value">45.2 MH/s</span>
                                <span>Hashrate</span>
                            </div>
                            <div class="miner-stat">
                                <span class="miner-stat-value">847</span>
                                <span>Shares</span>
                            </div>
                            <div class="miner-stat">
                                <span class="miner-stat-value">125 ADG</span>
                                <span>Rewards</span>
                            </div>
                        </div>
                    </div>
                    <div class="miner-item">
                        <div class="miner-header">
                            <span class="miner-name">‚ö° Gaming-Beast-RTX4080</span>
                            <span class="miner-status status-online">Online</span>
                        </div>
                        <div class="miner-stats">
                            <div class="miner-stat">
                                <span class="miner-stat-value">78.4 MH/s</span>
                                <span>Hashrate</span>
                            </div>
                            <div class="miner-stat">
                                <span class="miner-stat-value">1,234</span>
                                <span>Shares</span>
                            </div>
                            <div class="miner-stat">
                                <span class="miner-stat-value">289 ADG</span>
                                <span>Rewards</span>
                            </div>
                        </div>
                    </div>
                    <div class="miner-item">
                        <div class="miner-header">
                            <span class="miner-name">üî• Crypto-Farm-RX7900XT</span>
                            <span class="miner-status status-offline">Offline</span>
                        </div>
                        <div class="miner-stats">
                            <div class="miner-stat">
                                <span class="miner-stat-value">0 MH/s</span>
                                <span>Hashrate</span>
                            </div>
                            <div class="miner-stat">
                                <span class="miner-stat-value">567</span>
                                <span>Shares</span>
                            </div>
                            <div class="miner-stat">
                                <span class="miner-stat-value">98 ADG</span>
                                <span>Rewards</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Download Client -->
        <div class="download-section">
            <h2>üì• Scarica Adelchi Mining Client</h2>
            <p>Client leggero e ottimizzato per tutte le GPU. Plug & Play!</p>

            <div class="download-info">
                <div class="download-item">
                    <h3>ü™ü Windows</h3>
                    <p>Supporta RTX/GTX Serie</p>
                    <p><strong>v2.1.4</strong> - 45MB</p>
                </div>
                <div class="download-item">
                    <h3>üêß Linux</h3>
                    <p>Ubuntu/Debian/Arch</p>
                    <p><strong>v2.1.4</strong> - 38MB</p>
                </div>
                <div class="download-item">
                    <h3>üçé macOS</h3>
                    <p>Metal Performance Shaders</p>
                    <p><strong>v2.1.2</strong> - 52MB</p>
                </div>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-download" onclick="downloadClient('windows')">
                    ü™ü Download Windows
                </button>
                <button class="btn btn-download" onclick="downloadClient('linux')">
                    üêß Download Linux
                </button>
                <button class="btn btn-download" onclick="downloadClient('macos')">
                    üçé Download macOS
                </button>
            </div>
        </div>

        <!-- Visualizzazione Blockchain -->
        <div class="blockchain-viz">
            <h2>‚õìÔ∏è Adelchi Blockchain Live</h2>
            <div class="blocks-container" id="blocksContainer">
                <div class="block">
                    <div class="block-id">Block #1337</div>
                    <div class="block-hash">0x1a2b3c4d...</div>
                    <div class="block-reward">+50 ADG</div>
                </div>
                <div class="block">
                    <div class="block-id">Block #1338</div>
                    <div class="block-hash">0x5e6f7a8b...</div>
                    <div class="block-reward">+50 ADG</div>
                </div>
                <div class="block">
                    <div class="block-id">Block #1339</div>
                    <div class="block-hash">0x9c0d1e2f...</div>
                    <div class="block-reward">+50 ADG</div>
                </div>
                <div class="block">
                    <div class="block-id">Mining...</div>
                    <div class="block-hash">‚ö° In Progress</div>
                    <div class="block-reward">? ADG</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simulazione dati in tempo reale
        let stats = {
            hashrate: 2.4,
            miners: 47,
            blocks: 1337,
            rewards: 89245
        };

        // Aggiorna statistiche
        function updateStats() {
            stats.hashrate += (Math.random() - 0.5) * 0.1;
            stats.miners += Math.random() > 0.7 ? 1 : (Math.random() < 0.3 ? -1 : 0);

            if (Math.random() > 0.95) {
                stats.blocks += 1;
                stats.rewards += 50;
                addNewBlock();
            }

            document.getElementById('totalHashrate').textContent = stats.hashrate.toFixed(1) + ' TH/s';
            document.getElementById('activeMiners').textContent = Math.max(0, stats.miners);
            document.getElementById('blocksFound').textContent = stats.blocks.toLocaleString();
            document.getElementById('totalRewards').textContent = stats.rewards.toLocaleString();
        }

        // Aggiungi nuovo blocco alla visualizzazione
        function addNewBlock() {
            const container = document.getElementById('blocksContainer');
            const newBlock = document.createElement('div');
            newBlock.className = 'block';
            newBlock.innerHTML = `
                <div class="block-id">Block #${stats.blocks}</div>
                <div class="block-hash">0x${Math.random().toString(16).substr(2, 8)}...</div>
                <div class="block-reward">+50 ADG</div>
            `;

            // Rimuovi il blocco "Mining..." se esiste
            const miningBlock = container.querySelector('.block:last-child');
            if (miningBlock && miningBlock.textContent.includes('Mining')) {
                container.removeChild(miningBlock);
            }

            container.appendChild(newBlock);

            // Aggiungi nuovo blocco "Mining..."
            const newMiningBlock = document.createElement('div');
            newMiningBlock.className = 'block';
            newMiningBlock.innerHTML = `
                <div class="block-id">Mining...</div>
                <div class="block-hash">‚ö° In Progress</div>
                <div class="block-reward">? ADG</div>
            `;
            container.appendChild(newMiningBlock);

            // Mantieni solo gli ultimi 6 blocchi
            while (container.children.length > 6) {
                container.removeChild(container.firstChild);
            }
        }

        // Gestione form registrazione
        document.getElementById('minerRegistration').addEventListener('submit', function(e) {
            e.preventDefault();

            const minerName = document.getElementById('minerName').value;
            const gpuModel = document.getElementById('gpuModel').value;
            const walletAddress = document.getElementById('walletAddress').value;

            if (minerName && gpuModel && walletAddress) {
                alert(`‚úÖ Miner "${minerName}" registrato con successo!\n\nGPU: ${gpuModel.toUpperCase()}\nWallet: ${walletAddress}\n\nScarica il client per iniziare a minare!`);

                // Reset form
                this.reset();

                // Simula aggiunta alla lista (in realt√† andrebbe nel database)
                stats.miners += 1;
            }
        });

        // Download client
        function downloadClient(platform) {
            const urls = {
                windows: '/downloads/adelchi-miner-windows-v2.1.4.exe',
                linux: '/downloads/adelchi-miner-linux-v2.1.4.tar.gz',
                macos: '/downloads/adelchi-miner-macos-v2.1.2.dmg'
            };

            alert(`üöÄ Download iniziato!\n\nClient: Adelchi Miner ${platform.charAt(0).toUpperCase() + platform.slice(1)}\n\nDopo l'installazione:\n1. Inserisci le tue credenziali Adelchi\n2. Il client rilever√† automaticamente la GPU\n3. Inizia a minare!`);

            // In un'app reale, questo avvierebbe il download
            // window.location.href = urls[platform];
        }

        // Avvia aggiornamenti
        setInterval(updateStats, 3000);

        // Animazione iniziale
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateStats();
            }, 1000);
        });
    </script>
</body>
</html>