{% extends "base_app.html" %}

{% block title %}Crea Nota - Adelchi Group{% endblock %}

{% block content %}
<div class="glass-card" style="max-width: 800px; margin: 0 auto;">
    <h1 class="page-title">üìù Crea Nuova Nota</h1>
    <p class="page-subtitle">Organizza le tue idee e promemoria</p>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div style="background: rgba(72, 187, 120, 0.3); padding: 1rem; border-radius: 10px; margin-bottom: 1.5rem; border: 1px solid rgba(72, 187, 120, 0.5);">
                {% for message in messages %}
                    {{ message }}
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <form method="POST" action="/create_note">
        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Titolo *</label>
            <input type="text" name="title" required
                   style="width: 100%; padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Contenuto *</label>
            <textarea name="content" rows="6" required
                      style="width: 100%; padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 1rem; resize: vertical;"></textarea>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
            <div>
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Tipo Nota</label>
                <select name="note_type" id="note_type" style="width: 100%; padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
                    <option value="text">üìù Testo</option>
                    <option value="task">‚úÖ Task</option>
                    <option value="idea">üí° Idea</option>
                    <option value="link">üîó Link</option>
                </select>
            </div>

            <div>
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Priorit√†</label>
                <select name="priority" style="width: 100%; padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
                    <option value="low">Bassa</option>
                    <option value="normal" selected>Normale</option>
                    <option value="high">Alta</option>
                    <option value="urgent">Urgente</option>
                </select>
            </div>
        </div>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Tag (separati da virgola)</label>
            <input type="text" name="tags" placeholder="lavoro, importante, progetto..."
                   style="width: 100%; padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
        </div>

        <!-- ‚≠ê DROPDOWN PROGETTO -->
        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">üìÅ Assegna a Progetto (opzionale)</label>
            <select id="project_id" name="project_id" class="form-input form-select">
    <option value="">-- Nessun progetto (nota personale) --</option>
     {% for project in projects %}
         <option value="{{ project.id }}" {% if preselected_project_id == project.id %}selected{% endif %}>
            {{ project.name }}
        </option>
        {% endfor %}
            </select>
            <small style="opacity: 0.7; font-size: 0.85rem; display: block; margin-top: 0.5rem;">
                Seleziona un progetto per condividere questa nota con il team
            </small>
        </div>

        <!-- URL esterno (solo per link) -->
        <div id="urlGroup" style="display: none; margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">URL Esterno</label>
            <input type="url" name="external_url" placeholder="https://..."
                   style="width: 100%; padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
        </div>

        <!-- Scadenza (solo per task) -->
        <div id="dueDateGroup" style="display: none; margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Scadenza</label>
            <input type="date" name="due_date"
                   style="width: 100%; padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 1rem;">
        </div>

        <div style="display: flex; gap: 1rem; justify-content: center;">
            <button type="submit" style="background: linear-gradient(45deg, #E7D454, #F4E869); color: #005B94; padding: 1rem 2rem; border: none; border-radius: 25px; font-weight: 700; cursor: pointer; font-size: 1rem;">
                üíæ Salva Nota
            </button>
            <a href="/notes" style="background: rgba(255,255,255,0.2); color: white; padding: 1rem 2rem; border-radius: 25px; font-weight: 700; text-decoration: none; display: inline-block;">
                ‚ùå Annulla
            </a>
        </div>
    </form>
</div>

<script>
    // Mostra/nascondi campi in base al tipo
    document.getElementById('note_type').addEventListener('change', function() {
        const urlGroup = document.getElementById('urlGroup');
        const dueDateGroup = document.getElementById('dueDateGroup');

        urlGroup.style.display = 'none';
        dueDateGroup.style.display = 'none';

        if (this.value === 'link') {
            urlGroup.style.display = 'block';
        } else if (this.value === 'task') {
            dueDateGroup.style.display = 'block';
        }
    });
</script>
{% endblock %}