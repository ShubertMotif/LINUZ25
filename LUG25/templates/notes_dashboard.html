{% extends "base_app.html" %}

{% block title %}Note & Files - Adelchi Group{% endblock %}

{% block extra_css %}
<style>
    .section-divider {
        border-top: 2px solid rgba(231, 212, 84, 0.3);
        margin: 3rem 0;
    }

    .notes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .note-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }

    .note-card:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-5px);
    }

    .note-title {
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .note-meta {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .badge {
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.75rem;
        font-weight: 600;
        background: rgba(231, 212, 84, 0.3);
    }

    .note-content {
        opacity: 0.8;
        margin-bottom: 1rem;
        line-height: 1.5;
    }

    .note-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-sm {
        padding: 0.4rem 0.8rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s ease;
    }

    .btn-edit { background: rgba(59, 130, 246, 0.3); color: white; }
    .btn-delete { background: rgba(239, 68, 68, 0.3); color: white; }

    /* FILES SECTION - MINIMAL */
    .files-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
    }

    .file-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .file-info {
        flex: 1;
    }

    .file-name {
        font-weight: 600;
        margin-bottom: 0.3rem;
    }

    .file-size {
        font-size: 0.85rem;
        opacity: 0.7;
    }
</style>
{% endblock %}

{% block content %}
<!-- NOTES SECTION -->
<h1 class="page-title">üìù Note</h1>
<p class="page-subtitle">Le tue note e task</p>

<div style="margin-bottom: 2rem;">
    <a href="/create_note" style="background: linear-gradient(45deg, #E7D454, #F4E869); color: #005B94; padding: 0.8rem 1.5rem; border-radius: 20px; text-decoration: none; font-weight: 700; display: inline-block;">
        ‚ûï Nuova Nota
    </a>
</div>

{% if notes %}
<div class="notes-grid">
    {% for note in notes %}
    <div class="note-card">
        <div class="note-title">{{ note.title }}</div>
        <div class="note-meta">
            <span class="badge">{{ note.note_type }}</span>
            <span class="badge">{{ note.priority }}</span>
            {% if note.completed %}<span class="badge">‚úÖ Completato</span>{% endif %}
        </div>
        <div class="note-content">{{ note.content[:100] }}...</div>
        <div class="note-actions">
            <a href="/edit_note/{{ note.id }}" class="btn-sm btn-edit">‚úèÔ∏è Modifica</a>
            <button onclick="deleteNote({{ note.id }})" class="btn-sm btn-delete">üóëÔ∏è</button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="glass-card" style="text-align: center; padding: 3rem;">
    <div style="font-size: 4rem; opacity: 0.5;">üìù</div>
    <p>Nessuna nota ancora. Creane una!</p>
</div>
{% endif %}

<!-- DIVIDER -->
<div class="section-divider"></div>

<!-- FILES SECTION - MINIMAL -->
<h1 class="page-title">üìÅ Files</h1>
<p class="page-subtitle">I tuoi documenti</p>

<div style="margin-bottom: 2rem;">
    <input type="file" id="fileInput" multiple style="display: none;">
    <button onclick="document.getElementById('fileInput').click()" style="background: linear-gradient(45deg, #E7D454, #F4E869); color: #005B94; padding: 0.8rem 1.5rem; border-radius: 20px; border: none; font-weight: 700; cursor: pointer;">
        ‚¨ÜÔ∏è Carica File
    </button>
</div>

{% if files %}
<div class="files-list">
    {% for file in files %}
    <div class="file-item">
        <div class="file-info">
            <div class="file-name">üìÑ {{ file.original_filename }}</div>
            <div class="file-size">{{ "%.1f"|format(file.file_size / 1024) }} KB</div>
        </div>
        <a href="/download_file/{{ file.id }}" style="background: rgba(16, 185, 129, 0.3); color: white; padding: 0.4rem 0.8rem; border-radius: 8px; text-decoration: none; font-size: 0.85rem;">
            ‚¨áÔ∏è
        </a>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="glass-card" style="text-align: center; padding: 3rem;">
    <div style="font-size: 4rem; opacity: 0.5;">üìÅ</div>
    <p>Nessun file caricato</p>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
function deleteNote(noteId) {
    if (!confirm('Eliminare questa nota?')) return;
    fetch(`/delete_note/${noteId}`, { method: 'POST' })
        .then(r => r.json())
        .then(d => { if (d.success) location.reload(); });
}

document.getElementById('fileInput').addEventListener('change', (e) => {
    for (let file of e.target.files) {
        const formData = new FormData();
        formData.append('file', file);
        fetch('/upload_file', { method: 'POST', body: formData })
            .then(r => r.json())
            .then(d => { if (d.success) location.reload(); });
    }
});
</script>
{% endblock %}